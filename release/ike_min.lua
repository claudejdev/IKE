--[[
----------------------------------------------
IKE v1.1 by Nicholas Musurca (nick.musurca@gmail.com)
Licensed under GNU GPLv3. (https://www.gnu.org/licenses/gpl-3.0-standalone.html)

MAKE SURE YOU READ THE INCLUDED MANUAL BEFORE DOING ANYTHING WITH THIS CODE!
----------------------------------------------
]]--

local function a(b)if b-math.floor(b)>0 then error("trying to use bitwise operation on non-integer!")end end;local function c(d)local b=#d;local e=0;local f=1;for g=1,b do e=e+d[g]*f;f=f*2 end;return e end;local function h(i,j)local k={}local l={}if#i>#j then k=i;l=j else k=j;l=i end;for g=#l+1,#k do l[g]=0 end end;local m=function()end;local function n(b)local d=m(b)local o=math.max(#d,32)for g=1,o do if d[g]==1 then d[g]=0 else d[g]=1 end end;return c(d)end;m=function(b)a(b)if b<0 then return m(n(math.abs(b))+1)end;local d={}local p=1;while b>0 do local q=b%2;if q==1 then d[p]=1 else d[p]=0 end;b=(b-q)/2;p=p+1 end;return d end;local function r(s,b)local i=m(s)local j=m(b)h(i,j)local d={}local e=math.max(#i,#j)for g=1,e do if i[g]==0 and j[g]==0 then d[g]=0 else d[g]=1 end end;return c(d)end;local function t(s,b)local i=m(s)local j=m(b)h(i,j)local d={}local e=math.max(#i,#j)for g=1,e do if i[g]==0 or j[g]==0 then d[g]=0 else d[g]=1 end end;return c(d)end;local function u(s,b)local i=m(s)local j=m(b)h(i,j)local d={}local e=math.max(#i,#j)for g=1,e do if i[g]~=j[g]then d[g]=1 else d[g]=0 end end;return c(d)end;local function v(b,w)a(b)local x=0;if b<0 then b=n(math.abs(b))+1;x=2147483648 end;for g=1,w do b=b/2;b=r(math.floor(b),x)end;return math.floor(b)end;local function y(b,w)a(b)if b<0 then b=n(math.abs(b))+1 end;for g=1,w do b=b/2 end;return math.floor(b)end;local function z(b,w)a(b)if b<0 then b=n(math.abs(b))+1 end;for g=1,w do b=b*2 end;return t(b,4294967295)end;local function A(s,b)local B=r(n(s),n(b))local C=r(s,b)local e=t(C,B)return e end;local D={ff=tonumber('ffffffff',16),consts={}}string.gsub([[ d76aa478 e8c7b756 242070db c1bdceee
    f57c0faf 4787c62a a8304613 fd469501
    698098d8 8b44f7af ffff5bb1 895cd7be
    6b901122 fd987193 a679438e 49b40821
    f61e2562 c040b340 265e5a51 e9b6c7aa
    d62f105d 02441453 d8a1e681 e7d3fbc8
    21e1cde6 c33707d6 f4d50d87 455a14ed
    a9e3e905 fcefa3f8 676f02d9 8d2a4c8a
    fffa3942 8771f681 6d9d6122 fde5380c
    a4beea44 4bdecfa9 f6bb4b60 bebfbc70
    289b7ec6 eaa127fa d4ef3085 04881d05
    d9d4d039 e6db99e5 1fa27cf8 c4ac5665
    f4292244 432aff97 ab9423a7 fc93a039
    655b59c3 8f0ccc92 ffeff47d 85845dd1
    6fa87e4f fe2ce6e0 a3014314 4e0811a1
    f7537e82 bd3af235 2ad7d2bb eb86d391
    67452301 efcdab89 98badcfe 10325476 ]],"(%w+)",function(E)table.insert(D.consts,tonumber(E,16))end)function D.transform(F,G,H,I,J)local K=function(L,M,N)return r(t(L,M),t(-L-1,N))end;local O=function(L,M,N)return r(t(L,N),t(M,-N-1))end;local P=function(L,M,N)return u(L,u(M,N))end;local g=function(L,M,N)return u(M,r(L,-N-1))end;local N=function(K,Q,R,S,T,L,E,U)Q=t(Q+K(R,S,T)+L+U,D.ff)return r(z(t(Q,v(D.ff,E)),E),v(Q,32-E))+R end;local Q,R,S,T=F,G,H,I;local V=D.consts;Q=N(K,Q,R,S,T,J[0],7,V[1])T=N(K,T,Q,R,S,J[1],12,V[2])S=N(K,S,T,Q,R,J[2],17,V[3])R=N(K,R,S,T,Q,J[3],22,V[4])Q=N(K,Q,R,S,T,J[4],7,V[5])T=N(K,T,Q,R,S,J[5],12,V[6])S=N(K,S,T,Q,R,J[6],17,V[7])R=N(K,R,S,T,Q,J[7],22,V[8])Q=N(K,Q,R,S,T,J[8],7,V[9])T=N(K,T,Q,R,S,J[9],12,V[10])S=N(K,S,T,Q,R,J[10],17,V[11])R=N(K,R,S,T,Q,J[11],22,V[12])Q=N(K,Q,R,S,T,J[12],7,V[13])T=N(K,T,Q,R,S,J[13],12,V[14])S=N(K,S,T,Q,R,J[14],17,V[15])R=N(K,R,S,T,Q,J[15],22,V[16])Q=N(O,Q,R,S,T,J[1],5,V[17])T=N(O,T,Q,R,S,J[6],9,V[18])S=N(O,S,T,Q,R,J[11],14,V[19])R=N(O,R,S,T,Q,J[0],20,V[20])Q=N(O,Q,R,S,T,J[5],5,V[21])T=N(O,T,Q,R,S,J[10],9,V[22])S=N(O,S,T,Q,R,J[15],14,V[23])R=N(O,R,S,T,Q,J[4],20,V[24])Q=N(O,Q,R,S,T,J[9],5,V[25])T=N(O,T,Q,R,S,J[14],9,V[26])S=N(O,S,T,Q,R,J[3],14,V[27])R=N(O,R,S,T,Q,J[8],20,V[28])Q=N(O,Q,R,S,T,J[13],5,V[29])T=N(O,T,Q,R,S,J[2],9,V[30])S=N(O,S,T,Q,R,J[7],14,V[31])R=N(O,R,S,T,Q,J[12],20,V[32])Q=N(P,Q,R,S,T,J[5],4,V[33])T=N(P,T,Q,R,S,J[8],11,V[34])S=N(P,S,T,Q,R,J[11],16,V[35])R=N(P,R,S,T,Q,J[14],23,V[36])Q=N(P,Q,R,S,T,J[1],4,V[37])T=N(P,T,Q,R,S,J[4],11,V[38])S=N(P,S,T,Q,R,J[7],16,V[39])R=N(P,R,S,T,Q,J[10],23,V[40])Q=N(P,Q,R,S,T,J[13],4,V[41])T=N(P,T,Q,R,S,J[0],11,V[42])S=N(P,S,T,Q,R,J[3],16,V[43])R=N(P,R,S,T,Q,J[6],23,V[44])Q=N(P,Q,R,S,T,J[9],4,V[45])T=N(P,T,Q,R,S,J[12],11,V[46])S=N(P,S,T,Q,R,J[15],16,V[47])R=N(P,R,S,T,Q,J[2],23,V[48])Q=N(g,Q,R,S,T,J[0],6,V[49])T=N(g,T,Q,R,S,J[7],10,V[50])S=N(g,S,T,Q,R,J[14],15,V[51])R=N(g,R,S,T,Q,J[5],21,V[52])Q=N(g,Q,R,S,T,J[12],6,V[53])T=N(g,T,Q,R,S,J[3],10,V[54])S=N(g,S,T,Q,R,J[10],15,V[55])R=N(g,R,S,T,Q,J[1],21,V[56])Q=N(g,Q,R,S,T,J[8],6,V[57])T=N(g,T,Q,R,S,J[15],10,V[58])S=N(g,S,T,Q,R,J[6],15,V[59])R=N(g,R,S,T,Q,J[13],21,V[60])Q=N(g,Q,R,S,T,J[4],6,V[61])T=N(g,T,Q,R,S,J[11],10,V[62])S=N(g,S,T,Q,R,J[2],15,V[63])R=N(g,R,S,T,Q,J[9],21,V[64])return F+Q,G+R,H+S,I+T end;local function W(g)local K=function(E)return string.char(t(v(g,E),255))end;return K(0)..K(8)..K(16)..K(24)end;local function X(E)local Y=0;for g=1,string.len(E)do Y=Y*256+string.byte(E,g)end;return Y end;local function Z(E)local Y=0;for g=string.len(E),1,-1 do Y=Y*256+string.byte(E,g)end;return Y end;local function _(E,a0)local a1,a2=1,{}for g=1,#a0 do table.insert(a2,Z(string.sub(E,a1,a1+a0[g]-1)))a1=a1+a0[g]end;return a2 end;function D.Calc(E)local a3=string.len(E)local a4=56-a3%64;if a3%64>56 then a4=a4+64 end;if a4==0 then a4=64 end;E=E..string.char(128)..string.rep(string.char(0),a4-1)E=E..W(8*a3)..W(0)assert(string.len(E)%64==0)local V=D.consts;local Q,R,S,T=V[65],V[66],V[67],V[68]for g=1,string.len(E),64 do local J=_(string.sub(E,g,g+63),{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4})assert(#J==16)J[0]=table.remove(J,1)Q,R,S,T=D.transform(Q,R,S,T,J)end;local a5=function(a6)return X(W(a6))end;return string.format("%08x%08x%08x%08x",a5(Q),a5(R),a5(S),a5(T))end;function PadDigits(a7)local a8=tostring(a7)if#a8==1 then a8='0'..a8 end;return a8 end;function String_Split(a9,aa)if aa==nil then aa="%s"end;local V={}for ab in string.gmatch(a9,"([^"..aa.."]+)")do table.insert(V,ab)end;return V end;function Input_OK(ac)ScenEdit_MsgBox(ac,0)end;function Input_YesNo(ac)local ad={['Yes']=true,['No']=false}while true do local ae=ScenEdit_MsgBox(ac,4)if ae~='Cancel'then return ad[ae]end end;return false end;function Input_Number(ac)while true do local af=ScenEdit_InputBox(ac)if af then af=tonumber(af)if af then return af end else return nil end end end;function Input_String(ac)local af=ScenEdit_InputBox(ac)if af then return tostring(af)end;return""end;function StoreBoolean(ag,af)if af then ScenEdit_SetKeyValue(ag,'Yes')else ScenEdit_SetKeyValue(ag,'No')end end;function GetBoolean(ag)local af=ScenEdit_GetKeyValue(ag)if af then if af=='Yes'then return true end end;return false end;function StoreString(ag,af)ScenEdit_SetKeyValue(ag,af)end;function GetString(ag)return ScenEdit_GetKeyValue(ag)end;function StoreNumber(ag,af)ScenEdit_SetKeyValue(ag,tostring(af))end;function GetNumber(ag)local af=tonumber(ScenEdit_GetKeyValue(ag))if af then return af end;return 0 end;function StoreStringArray(ag,ah)local ai=ag.."_LENGTH"StoreNumber(ai,#ah)for g=1,#ah do StoreString(ag.."_"..g,tostring(ah[g]))end end;function GetStringArray(ag)local ah={}local ai=GetNumber(ag.."_LENGTH")for g=1,ai do table.insert(ah,GetString(ag.."_"..g))end;return ah end;PBEM_DUMMY_SIDE='PBEM'PBEM_UNITYPES={1,2,3,4,7}function PBEM_StartTimeToUTC()local aj=os.date("!%m.%d.%Y",VP_GetScenario().StartTimeNum)local ak=os.date("!%H.%M.%S",VP_GetScenario().StartTimeNum)return{Date=aj,Time=ak}end;function PBEM_CurrentTimeMilitary()return os.date("!%m/%d/%Y %H:%M:%S",VP_GetScenario().CurrentTimeNum)end;function PBEM_ScenarioStartTime()return GetNumber("__PBEM_STARTTIME")end;function PBEM_GetNextTurnStartTime()local al=VP_GetScenario().StartTimeNum;local am=#PBEM_PLAYABLE_SIDES;local an=Turn_GetCurSide()local ao=Turn_GetTurnNumber()return al+PBEM_TURN_LENGTH*(ao-1)*am+PBEM_TURN_LENGTH*an end;function PBEM_GetCurTurnStartTime()return PBEM_GetNextTurnStartTime()-PBEM_TURN_LENGTH end;function PBEM_CheckSideSecurity()local ap=ScenEdit_PlayerSide()local al=VP_GetScenario().StartTimeNum;local aq=ScenEdit_CurrentTime()local ar=Turn_GetTurnNumber()if Turn_GetTurnNumber()>0 then if PBEM_GetNextTurnStartTime()==aq then Turn_NextSide()ScenEdit_PlaySound("radioChirp5.mp3")local as=Message_Header('End of '..ap..' Turn '..ar)..'Go to <b>File -> Save As...</b>, save this game, and send the save file to the <b>'..Turn_GetCurSideName()..'</b> player via email or another transfer service.<br/><br/><u>IMPORTANT:</u> Do <b>NOT</b> close this window or resume the game before saving, or you will have to replay your turn.'ScenEdit_SpecialMessage('playerside',as)PBEM_EndRandom()else local at=aq-al;if at%PBEM_TURN_LENGTH~=0 then local au=math.floor(at/PBEM_TURN_LENGTH)%#PBEM_PLAYABLE_SIDES+1;if ap~=PBEM_PLAYABLE_SIDES[au]then PBEM_SelfDestruct()end end end else PBEM_EndSetupPhase()end end;function PBEM_ShowRemainingTime()if Turn_GetTurnNumber()==0 and PBEM_SETUP_PHASE then Input_OK("This is the setup phase.")else local av=PBEM_GetNextTurnStartTime()-ScenEdit_CurrentTime()local aw={}local ax=math.floor(av/(60*60))local ay=math.floor((av-ax*60*60)/60)local az=math.floor(av-ax*60*60-ay*60)Input_OK("Time remaining in your turn: "..PadDigits(ax)..":"..PadDigits(ay)..":"..PadDigits(az)..".")end end;function PBEM_SideNumberByName(aA)for g=1,#PBEM_PLAYABLE_SIDES do if PBEM_PLAYABLE_SIDES[g]==aA then return g end end;return 1 end;function PBEM_SetKillRegister(aB,aC)StoreString("__SIDE_"..tostring(aB)..'_LOSSES',aC)end;function PBEM_GetKillRegister(aB)return string.sub(GetString("__SIDE_"..tostring(aB)..'_LOSSES'),0)end;function Message_Header(aD)return'<br/><hr><br/><center><b>'..aD..'</b></center><br/><hr><br/>'end;function PBEM_RegisterUnitKilled()local aE=ScenEdit_UnitX()local aF=PBEM_CurrentTimeMilitary()local aB=PBEM_SideNumberByName(aE.side)local aG=PBEM_GetKillRegister(aB)local aH;if aE.name==aE.classname then aH=aE.name else aH=aE.name..' ('..aE.classname..')'end;aG=aG..aF..' // '..aH..'<br/>'PBEM_SetKillRegister(aB,aG)end;function PBEM_ScoreSummary()local aI=""for g=1,#PBEM_PLAYABLE_SIDES do local aA=PBEM_PLAYABLE_SIDES[g]local aJ=ScenEdit_GetScore(aA)aI=aI..'<center><b>'..aA..':  '..aJ..'</b></center><br/><br/>'end;return aI end;function PBEM_HasSetupPhase()return GetBoolean("__SCEN_SETUPPHASE")end;function PBEM_PlayableSides()return GetStringArray('__SCEN_PLAYABLESIDES')end;function PBEM_TurnLength()return GetNumber('__TURN_LENGTH')end;function PBEM_ScenarioOver()ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,awareness='OMNI'})local aK=PBEM_ScoreSummary()local as=Message_Header('End of Scenario')..aK..'Go to <b>File -> Save As...</b>, save this game, and send the save file to the other players via email or another transfer service.<br/><br/>'ScenEdit_SpecialMessage('playerside',as)end;function PBEM_SetPassword(aB,aL)StoreString("__SIDE_"..tostring(aB).."_PASSWD",D.Calc(aL))end;function PBEM_CheckPassword(aB,aL)local aM=GetString("__SIDE_"..tostring(aB).."_PASSWD")return aM==D.Calc(aL)end;function PBEM_EventExists(aN)local aO=ScenEdit_GetEvents()for g=1,#aO do local aP=aO[g]if aP.name==aN then return true end end;return false end;function Turn_GetTurnNumber()return GetNumber('__TURN_CURNUM')end;function Turn_NextTurnNumber()StoreNumber('__TURN_CURNUM',Turn_GetTurnNumber()+1)end;function Turn_GetCurSide()return GetNumber('__TURN_CURSIDE')end;function Turn_GetCurSideName()return PBEM_PLAYABLE_SIDES[Turn_GetCurSide()]end;function Turn_SetCurSide(aB)StoreNumber('__TURN_CURSIDE',aB)end;function Turn_NextSide()local aQ=Turn_GetCurSide()-1;aQ=(1+aQ)%#PBEM_PLAYABLE_SIDES+1;if aQ==1 then Turn_NextTurnNumber()end;Turn_SetCurSide(aQ)ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,switchto=true})end;function PBEM_SelfDestruct()local aR=VP_GetSides()for g=1,#aR do StoreString("__SIDE_"..tostring(g).."_PASSWD","")ScenEdit_RemoveSide({side=aR[g].name})end;PBEM_EndRandom()end;function PBEM_ShowTurnIntro()local aS=Turn_GetCurSide()local ar=Turn_GetTurnNumber()local aT=""if ar>1 or aS>1 then local aG=PBEM_GetKillRegister(aS)if aG==''then aG="None."end;aT='<br/><u>Losses reported:</u><br/><br/>'..aG end;PBEM_SetKillRegister(aS,"")ScenEdit_SpecialMessage('playerside',Message_Header(Turn_GetCurSideName()..' Turn '..tostring(ar))..aT)end;function PBEM_RandomSeed(Q)StoreNumber('__PBEM_RANDOMSEEDVAL',Q)end;function PBEM_NextRandomSeed()PBEM_RandomSeed(__PBEM_FN_RANDOM(-2147483648,2147483647))end;function PBEM_Random(aU,aV)local aW=0;if aU then if aV then aW=__PBEM_FN_RANDOM(aU,aV)else aW=__PBEM_FN_RANDOM(aU)end else aW=__PBEM_FN_RANDOM()end;PBEM_NextRandomSeed()return aW end;function PBEM_InitRandom()if not __PBEM_FN_RANDOMSEED then __PBEM_FN_RANDOMSEED=math.randomseed;__PBEM_FN_RANDOM=math.random end;math.randomseed=function(Q)end;math.random=PBEM_Random;__PBEM_FN_RANDOMSEED(GetNumber('__PBEM_RANDOMSEEDVAL'))__PBEM_FN_RANDOM()__PBEM_FN_RANDOM()__PBEM_FN_RANDOM()PBEM_NextRandomSeed()end;function PBEM_EndRandom()math.randomseed=__PBEM_FN_RANDOMSEED;math.random=__PBEM_FN_RANDOM end;function PBEM_StartTurn()PBEM_SETUP_PHASE=PBEM_HasSetupPhase()PBEM_TURN_LENGTH=PBEM_TurnLength()PBEM_PLAYABLE_SIDES=PBEM_PlayableSides()ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,switchto=true})local aA=Turn_GetCurSideName()local ar=Turn_GetTurnNumber()local aX=ScenEdit_CurrentTime()if ScenEdit_GetSideOptions({side=PBEM_DUMMY_SIDE}).awareness=='Omniscient'then local as=Message_Header("End of Scenario (Turn "..ar..')')..PBEM_ScoreSummary()ScenEdit_SpecialMessage('playerside',as)return end;if ar==1 and not PBEM_SETUP_PHASE and aX==PBEM_GetCurTurnStartTime()or ar==0 and PBEM_SETUP_PHASE then if Turn_GetCurSide()==1 then PBEM_RandomSeed(os.time())if PBEM_OnInitialSetup then PBEM_OnInitialSetup()end end;PBEM_InitRandom()local aY=false;local aZ=0;local a_=""while not aY do aZ=aZ+1;local as=""if aZ>1 then as="Passwords didn\'t match! Please enter your password again:"else as=aA..", please choose a password:"end;a_=Input_String(as)local b0=Input_String("Enter password again to confirm:")if a_==b0 then aY=true end end;PBEM_SetPassword(Turn_GetCurSide(),a_)ScenEdit_SetSideOptions({side=aA,switchto=true})if ar==0 and PBEM_SETUP_PHASE then PBEM_StartSetupPhase()else PBEM_ShowTurnIntro()end else PBEM_InitRandom()local b1=false;while not b1 do local a_=Input_String(aA..", enter your password to start turn "..ar..":")if PBEM_CheckPassword(Turn_GetCurSide(),a_)then ScenEdit_SetSideOptions({side=aA,switchto=true})b1=true else local b2=ScenEdit_MsgBox("The password was incorrect.",5)if b2~='Retry'then PBEM_SelfDestruct()return end end end;local b3=PBEM_GetCurTurnStartTime()local b4=ScenEdit_CurrentTime()if PBEM_SETUP_PHASE and ar==1 and b4==b3+#PBEM_PLAYABLE_SIDES or b4==b3 then PBEM_ShowTurnIntro()end end end;function PBEM_StartSetupPhase()local aA=ScenEdit_PlayerSide()Input_OK("This is the "..aA.." setup phase.\n\nLeave the game paused until you've finished setting up your loadouts and missions.\n\nWhen you're done, click Play to end your turn.")end;function PBEM_EndSetupPhase()local aA=ScenEdit_PlayerSide()Turn_NextSide()ScenEdit_PlaySound("radioChirp5.mp3")local as=Message_Header('End of '..aA..' Setup Phase')..'Go to <b>File -> Save As...</b>, save this game, and send the save file to the <b>'..Turn_GetCurSideName()..'</b> player via email or another transfer service.<br/><br/><u>IMPORTANT:</u> Do <b>NOT</b> close this window or resume the game before saving, or you will have to replay your turn.'ScenEdit_SpecialMessage('playerside',as)PBEM_EndRandom()end;PBEM_INTRO_MSG=[[Welcome to IKE v1.1! This tool adds PBEM/hotseat play to any Command: Modern Operations scenario.

Running this tool cannot be undone. Have you saved a backup of this scenario?]]PBEM_LAST_MSG=[[Success! Your PBEM/hotseat scenario has been initialized. Go to FILE -> SAVE AS... to save it under a new name. It will be ready to play when next loaded.

(If you're planning to publish it to the Steam Workshop, you should do it now, before you close this scenario.)

Thanks for using IKE!]]function PBEM_Init()if not Input_YesNo(PBEM_INTRO_MSG)then Input_OK("Please save a backup first, then RUN this tool again.")return end;local b5=Input_Number("Enter the desired TURN LENGTH in minutes:")if not b5 then return end;b5=math.floor(b5)local aR=VP_GetSides()local b6={}for g=1,#aR do if Input_YesNo("Should the "..aR[g].name.." side be PLAYABLE?")then table.insert(b6,aR[g].name)end end;local b7=false;while not b7 do for g=1,#b6 do if Input_YesNo("Should the "..b6[g].." side go FIRST?")then local b8=b6[1]b6[1]=b6[g]b6[g]=b8;b7=true;break end end end;for g=1,#b6 do local b9=b6[g]for ba=1,#aR do local bb=aR[ba]if bb.name==b9 then if#bb.missions>0 then if Input_YesNo("Clear any existing missions for the "..b9 .." side?")then while#bb.missions>0 do local s=bb.missions[1]ScenEdit_DeleteMission(s.side,s.name)end end end;break end end end;local bc=Input_YesNo("Should the game start with a SETUP PHASE?")PBEM_SETUP_PHASE=bc;PBEM_TURN_LENGTH=b5*60;PBEM_PLAYABLE_SIDES=b6;StoreStringArray("__SCEN_PLAYABLESIDES",PBEM_PLAYABLE_SIDES)StoreNumber('__TURN_LENGTH',PBEM_TURN_LENGTH)StoreBoolean('__SCEN_SETUPPHASE',PBEM_SETUP_PHASE)if not PBEM_EventExists('PBEM: Scenario Loaded')then ScenEdit_AddSide({name=PBEM_DUMMY_SIDE})ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,awareness='BLIND'})ScenEdit_SetEvent('PBEM: Scenario Loaded',{mode='add',IsRepeatable=true,IsShown=false})ScenEdit_SetTrigger({name='PBEM_Scenario_Loaded',mode='add',type='ScenLoaded'})ScenEdit_SetAction({name='PBEM: Turn Starts',mode='add',type='LuaScript',ScriptText=IKE_LOADER})ScenEdit_SetEventTrigger('PBEM: Scenario Loaded',{mode='add',name='PBEM_Scenario_Loaded'})ScenEdit_SetEventAction('PBEM: Scenario Loaded',{mode='add',name='PBEM: Turn Starts'})ScenEdit_SetEvent('PBEM: Turn Security',{mode='add',IsRepeatable=true,IsShown=false})ScenEdit_SetTrigger({name='PBEM_Turn_Security',mode='add',type='RegularTime',interval=0})ScenEdit_SetAction({name='PBEM: Check Turn Security',mode='add',type='LuaScript',ScriptText='PBEM_CheckSideSecurity()'})ScenEdit_SetEventTrigger('PBEM: Turn Security',{mode='add',name='PBEM_Turn_Security'})ScenEdit_SetEventAction('PBEM: Turn Security',{mode='add',name='PBEM: Check Turn Security'})ScenEdit_SetEvent('PBEM: Turn Event Tracker',{mode='add',IsRepeatable=true,IsShown=false})for g=1,#PBEM_UNITYPES do local bd='PBEM_Unit_Killed_'..g;ScenEdit_SetTrigger({name=bd,mode='add',type='UnitDestroyed',TargetFilter={TargetType=PBEM_UNITYPES[g],TargetSubType=0}})ScenEdit_SetEventTrigger('PBEM: Turn Event Tracker',{mode='add',name=bd})end;ScenEdit_SetAction({name='PBEM: Register Unit Killed',mode='add',type='LuaScript',ScriptText='PBEM_RegisterUnitKilled()'})ScenEdit_SetEventAction('PBEM: Turn Event Tracker',{mode='add',name='PBEM: Register Unit Killed'})ScenEdit_SetEvent('PBEM: Scenario Over',{mode='add',IsRepeatable=false,IsShown=false})ScenEdit_SetTrigger({name='PBEM_On_Scenario_End',mode='add',type='ScenEnded'})ScenEdit_SetEventTrigger('PBEM: Scenario Over',{mode='add',name='PBEM_On_Scenario_End'})ScenEdit_SetAction({name='PBEM: End the Scenario',mode='add',type='LuaScript',ScriptText='PBEM_ScenarioOver()'})ScenEdit_SetEventAction('PBEM: Scenario Over',{mode='add',name='PBEM: End the Scenario'})for g=1,#PBEM_PLAYABLE_SIDES do ScenEdit_AddSpecialAction({ActionNameOrID='PBEM: Show remaining time in turn',Description="Display the remaining time before your PBEM turn ends.",Side=PBEM_PLAYABLE_SIDES[g],IsActive=true,IsRepeatable=true,ScriptText='PBEM_ShowRemainingTime()'})PBEM_SetKillRegister(g,"")end end;Turn_SetCurSide(1)local be=1;if PBEM_HasSetupPhase()then be=0 end;ScenEdit_SetTime(PBEM_StartTimeToUTC())StoreNumber('__TURN_CURNUM',be)ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,switchto=true})Input_OK(PBEM_LAST_MSG)end;IKE_LOADER="local function a(b)if b-math.floor(b)>0 then error(\"trying to use bitwise operation on non-integer!\")end end;local function c(d)local b=#d;local e=0;local f=1;for g=1,b do e=e+d[g]*f;f=f*2 end;return e end;local function h(i,j)local k={}local l={}if#i>#j then k=i;l=j else k=j;l=i end;for g=#l+1,#k do l[g]=0 end end;local m=function()end;local function n(b)local d=m(b)local o=math.max(#d,32)for g=1,o do if d[g]==1 then d[g]=0 else d[g]=1 end end;return c(d)end;m=function(b)a(b)if b<0 then return m(n(math.abs(b))+1)end;local d={}local p=1;while b>0 do local q=b%2;if q==1 then d[p]=1 else d[p]=0 end;b=(b-q)/2;p=p+1 end;return d end;local function r(s,b)local i=m(s)local j=m(b)h(i,j)local d={}local e=math.max(#i,#j)for g=1,e do if i[g]==0 and j[g]==0 then d[g]=0 else d[g]=1 end end;return c(d)end;local function t(s,b)local i=m(s)local j=m(b)h(i,j)local d={}local e=math.max(#i,#j)for g=1,e do if i[g]==0 or j[g]==0 then d[g]=0 else d[g]=1 end end;return c(d)end;local function u(s,b)local i=m(s)local j=m(b)h(i,j)local d={}local e=math.max(#i,#j)for g=1,e do if i[g]~=j[g]then d[g]=1 else d[g]=0 end end;return c(d)end;local function v(b,w)a(b)local x=0;if b<0 then b=n(math.abs(b))+1;x=2147483648 end;for g=1,w do b=b/2;b=r(math.floor(b),x)end;return math.floor(b)end;local function y(b,w)a(b)if b<0 then b=n(math.abs(b))+1 end;for g=1,w do b=b/2 end;return math.floor(b)end;local function z(b,w)a(b)if b<0 then b=n(math.abs(b))+1 end;for g=1,w do b=b*2 end;return t(b,4294967295)end;local function A(s,b)local B=r(n(s),n(b))local C=r(s,b)local e=t(C,B)return e end;local D={ff=tonumber('ffffffff',16),consts={}}string.gsub([[ d76aa478 e8c7b756 242070db c1bdceee\r\n    f57c0faf 4787c62a a8304613 fd469501\r\n    698098d8 8b44f7af ffff5bb1 895cd7be\r\n    6b901122 fd987193 a679438e 49b40821\r\n    f61e2562 c040b340 265e5a51 e9b6c7aa\r\n    d62f105d 02441453 d8a1e681 e7d3fbc8\r\n    21e1cde6 c33707d6 f4d50d87 455a14ed\r\n    a9e3e905 fcefa3f8 676f02d9 8d2a4c8a\r\n    fffa3942 8771f681 6d9d6122 fde5380c\r\n    a4beea44 4bdecfa9 f6bb4b60 bebfbc70\r\n    289b7ec6 eaa127fa d4ef3085 04881d05\r\n    d9d4d039 e6db99e5 1fa27cf8 c4ac5665\r\n    f4292244 432aff97 ab9423a7 fc93a039\r\n    655b59c3 8f0ccc92 ffeff47d 85845dd1\r\n    6fa87e4f fe2ce6e0 a3014314 4e0811a1\r\n    f7537e82 bd3af235 2ad7d2bb eb86d391\r\n    67452301 efcdab89 98badcfe 10325476 ]],\"(%w+)\",function(E)table.insert(D.consts,tonumber(E,16))end)function D.transform(F,G,H,I,J)local K=function(L,M,N)return r(t(L,M),t(-L-1,N))end;local O=function(L,M,N)return r(t(L,N),t(M,-N-1))end;local P=function(L,M,N)return u(L,u(M,N))end;local g=function(L,M,N)return u(M,r(L,-N-1))end;local N=function(K,Q,R,S,T,L,E,U)Q=t(Q+K(R,S,T)+L+U,D.ff)return r(z(t(Q,v(D.ff,E)),E),v(Q,32-E))+R end;local Q,R,S,T=F,G,H,I;local V=D.consts;Q=N(K,Q,R,S,T,J[0],7,V[1])T=N(K,T,Q,R,S,J[1],12,V[2])S=N(K,S,T,Q,R,J[2],17,V[3])R=N(K,R,S,T,Q,J[3],22,V[4])Q=N(K,Q,R,S,T,J[4],7,V[5])T=N(K,T,Q,R,S,J[5],12,V[6])S=N(K,S,T,Q,R,J[6],17,V[7])R=N(K,R,S,T,Q,J[7],22,V[8])Q=N(K,Q,R,S,T,J[8],7,V[9])T=N(K,T,Q,R,S,J[9],12,V[10])S=N(K,S,T,Q,R,J[10],17,V[11])R=N(K,R,S,T,Q,J[11],22,V[12])Q=N(K,Q,R,S,T,J[12],7,V[13])T=N(K,T,Q,R,S,J[13],12,V[14])S=N(K,S,T,Q,R,J[14],17,V[15])R=N(K,R,S,T,Q,J[15],22,V[16])Q=N(O,Q,R,S,T,J[1],5,V[17])T=N(O,T,Q,R,S,J[6],9,V[18])S=N(O,S,T,Q,R,J[11],14,V[19])R=N(O,R,S,T,Q,J[0],20,V[20])Q=N(O,Q,R,S,T,J[5],5,V[21])T=N(O,T,Q,R,S,J[10],9,V[22])S=N(O,S,T,Q,R,J[15],14,V[23])R=N(O,R,S,T,Q,J[4],20,V[24])Q=N(O,Q,R,S,T,J[9],5,V[25])T=N(O,T,Q,R,S,J[14],9,V[26])S=N(O,S,T,Q,R,J[3],14,V[27])R=N(O,R,S,T,Q,J[8],20,V[28])Q=N(O,Q,R,S,T,J[13],5,V[29])T=N(O,T,Q,R,S,J[2],9,V[30])S=N(O,S,T,Q,R,J[7],14,V[31])R=N(O,R,S,T,Q,J[12],20,V[32])Q=N(P,Q,R,S,T,J[5],4,V[33])T=N(P,T,Q,R,S,J[8],11,V[34])S=N(P,S,T,Q,R,J[11],16,V[35])R=N(P,R,S,T,Q,J[14],23,V[36])Q=N(P,Q,R,S,T,J[1],4,V[37])T=N(P,T,Q,R,S,J[4],11,V[38])S=N(P,S,T,Q,R,J[7],16,V[39])R=N(P,R,S,T,Q,J[10],23,V[40])Q=N(P,Q,R,S,T,J[13],4,V[41])T=N(P,T,Q,R,S,J[0],11,V[42])S=N(P,S,T,Q,R,J[3],16,V[43])R=N(P,R,S,T,Q,J[6],23,V[44])Q=N(P,Q,R,S,T,J[9],4,V[45])T=N(P,T,Q,R,S,J[12],11,V[46])S=N(P,S,T,Q,R,J[15],16,V[47])R=N(P,R,S,T,Q,J[2],23,V[48])Q=N(g,Q,R,S,T,J[0],6,V[49])T=N(g,T,Q,R,S,J[7],10,V[50])S=N(g,S,T,Q,R,J[14],15,V[51])R=N(g,R,S,T,Q,J[5],21,V[52])Q=N(g,Q,R,S,T,J[12],6,V[53])T=N(g,T,Q,R,S,J[3],10,V[54])S=N(g,S,T,Q,R,J[10],15,V[55])R=N(g,R,S,T,Q,J[1],21,V[56])Q=N(g,Q,R,S,T,J[8],6,V[57])T=N(g,T,Q,R,S,J[15],10,V[58])S=N(g,S,T,Q,R,J[6],15,V[59])R=N(g,R,S,T,Q,J[13],21,V[60])Q=N(g,Q,R,S,T,J[4],6,V[61])T=N(g,T,Q,R,S,J[11],10,V[62])S=N(g,S,T,Q,R,J[2],15,V[63])R=N(g,R,S,T,Q,J[9],21,V[64])return F+Q,G+R,H+S,I+T end;local function W(g)local K=function(E)return string.char(t(v(g,E),255))end;return K(0)..K(8)..K(16)..K(24)end;local function X(E)local Y=0;for g=1,string.len(E)do Y=Y*256+string.byte(E,g)end;return Y end;local function Z(E)local Y=0;for g=string.len(E),1,-1 do Y=Y*256+string.byte(E,g)end;return Y end;local function _(E,a0)local a1,a2=1,{}for g=1,#a0 do table.insert(a2,Z(string.sub(E,a1,a1+a0[g]-1)))a1=a1+a0[g]end;return a2 end;function D.Calc(E)local a3=string.len(E)local a4=56-a3%64;if a3%64>56 then a4=a4+64 end;if a4==0 then a4=64 end;E=E..string.char(128)..string.rep(string.char(0),a4-1)E=E..W(8*a3)..W(0)assert(string.len(E)%64==0)local V=D.consts;local Q,R,S,T=V[65],V[66],V[67],V[68]for g=1,string.len(E),64 do local J=_(string.sub(E,g,g+63),{4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4})assert(#J==16)J[0]=table.remove(J,1)Q,R,S,T=D.transform(Q,R,S,T,J)end;local a5=function(a6)return X(W(a6))end;return string.format(\"%08x%08x%08x%08x\",a5(Q),a5(R),a5(S),a5(T))end;function PadDigits(a7)local a8=tostring(a7)if#a8==1 then a8='0'..a8 end;return a8 end;function String_Split(a9,aa)if aa==nil then aa=\"%s\"end;local V={}for ab in string.gmatch(a9,\"([^\"..aa..\"]+)\")do table.insert(V,ab)end;return V end;function Input_OK(ac)ScenEdit_MsgBox(ac,0)end;function Input_YesNo(ac)local ad={['Yes']=true,['No']=false}while true do local ae=ScenEdit_MsgBox(ac,4)if ae~='Cancel'then return ad[ae]end end;return false end;function Input_Number(ac)while true do local af=ScenEdit_InputBox(ac)if af then af=tonumber(af)if af then return af end else return nil end end end;function Input_String(ac)local af=ScenEdit_InputBox(ac)if af then return tostring(af)end;return\"\"end;function StoreBoolean(ag,af)if af then ScenEdit_SetKeyValue(ag,'Yes')else ScenEdit_SetKeyValue(ag,'No')end end;function GetBoolean(ag)local af=ScenEdit_GetKeyValue(ag)if af then if af=='Yes'then return true end end;return false end;function StoreString(ag,af)ScenEdit_SetKeyValue(ag,af)end;function GetString(ag)return ScenEdit_GetKeyValue(ag)end;function StoreNumber(ag,af)ScenEdit_SetKeyValue(ag,tostring(af))end;function GetNumber(ag)local af=tonumber(ScenEdit_GetKeyValue(ag))if af then return af end;return 0 end;function StoreStringArray(ag,ah)local ai=ag..\"_LENGTH\"StoreNumber(ai,#ah)for g=1,#ah do StoreString(ag..\"_\"..g,tostring(ah[g]))end end;function GetStringArray(ag)local ah={}local ai=GetNumber(ag..\"_LENGTH\")for g=1,ai do table.insert(ah,GetString(ag..\"_\"..g))end;return ah end;PBEM_DUMMY_SIDE='PBEM'PBEM_UNITYPES={1,2,3,4,7}function PBEM_StartTimeToUTC()local aj=os.date(\"!%m.%d.%Y\",VP_GetScenario().StartTimeNum)local ak=os.date(\"!%H.%M.%S\",VP_GetScenario().StartTimeNum)return{Date=aj,Time=ak}end;function PBEM_CurrentTimeMilitary()return os.date(\"!%m/%d/%Y %H:%M:%S\",VP_GetScenario().CurrentTimeNum)end;function PBEM_ScenarioStartTime()return GetNumber(\"__PBEM_STARTTIME\")end;function PBEM_GetNextTurnStartTime()local al=VP_GetScenario().StartTimeNum;local am=#PBEM_PLAYABLE_SIDES;local an=Turn_GetCurSide()local ao=Turn_GetTurnNumber()return al+PBEM_TURN_LENGTH*(ao-1)*am+PBEM_TURN_LENGTH*an end;function PBEM_GetCurTurnStartTime()return PBEM_GetNextTurnStartTime()-PBEM_TURN_LENGTH end;function PBEM_CheckSideSecurity()local ap=ScenEdit_PlayerSide()local al=VP_GetScenario().StartTimeNum;local aq=ScenEdit_CurrentTime()local ar=Turn_GetTurnNumber()if Turn_GetTurnNumber()>0 then if PBEM_GetNextTurnStartTime()==aq then Turn_NextSide()ScenEdit_PlaySound(\"radioChirp5.mp3\")local as=Message_Header('End of '..ap..' Turn '..ar)..'Go to <b>File -> Save As...</b>, save this game, and send the save file to the <b>'..Turn_GetCurSideName()..'</b> player via email or another transfer service.<br/><br/><u>IMPORTANT:</u> Do <b>NOT</b> close this window or resume the game before saving, or you will have to replay your turn.'ScenEdit_SpecialMessage('playerside',as)PBEM_EndRandom()else local at=aq-al;if at%PBEM_TURN_LENGTH~=0 then local au=math.floor(at/PBEM_TURN_LENGTH)%#PBEM_PLAYABLE_SIDES+1;if ap~=PBEM_PLAYABLE_SIDES[au]then PBEM_SelfDestruct()end end end else PBEM_EndSetupPhase()end end;function PBEM_ShowRemainingTime()if Turn_GetTurnNumber()==0 and PBEM_SETUP_PHASE then Input_OK(\"This is the setup phase.\")else local av=PBEM_GetNextTurnStartTime()-ScenEdit_CurrentTime()local aw={}local ax=math.floor(av/(60*60))local ay=math.floor((av-ax*60*60)/60)local az=math.floor(av-ax*60*60-ay*60)Input_OK(\"Time remaining in your turn: \"..PadDigits(ax)..\":\"..PadDigits(ay)..\":\"..PadDigits(az)..\".\")end end;function PBEM_SideNumberByName(aA)for g=1,#PBEM_PLAYABLE_SIDES do if PBEM_PLAYABLE_SIDES[g]==aA then return g end end;return 1 end;function PBEM_SetKillRegister(aB,aC)StoreString(\"__SIDE_\"..tostring(aB)..'_LOSSES',aC)end;function PBEM_GetKillRegister(aB)return string.sub(GetString(\"__SIDE_\"..tostring(aB)..'_LOSSES'),0)end;function Message_Header(aD)return'<br/><hr><br/><center><b>'..aD..'</b></center><br/><hr><br/>'end;function PBEM_RegisterUnitKilled()local aE=ScenEdit_UnitX()local aF=PBEM_CurrentTimeMilitary()local aB=PBEM_SideNumberByName(aE.side)local aG=PBEM_GetKillRegister(aB)local aH;if aE.name==aE.classname then aH=aE.name else aH=aE.name..' ('..aE.classname..')'end;aG=aG..aF..' // '..aH..'<br/>'PBEM_SetKillRegister(aB,aG)end;function PBEM_ScoreSummary()local aI=\"\"for g=1,#PBEM_PLAYABLE_SIDES do local aA=PBEM_PLAYABLE_SIDES[g]local aJ=ScenEdit_GetScore(aA)aI=aI..'<center><b>'..aA..':  '..aJ..'</b></center><br/><br/>'end;return aI end;function PBEM_HasSetupPhase()return GetBoolean(\"__SCEN_SETUPPHASE\")end;function PBEM_PlayableSides()return GetStringArray('__SCEN_PLAYABLESIDES')end;function PBEM_TurnLength()return GetNumber('__TURN_LENGTH')end;function PBEM_ScenarioOver()ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,awareness='OMNI'})local aK=PBEM_ScoreSummary()local as=Message_Header('End of Scenario')..aK..'Go to <b>File -> Save As...</b>, save this game, and send the save file to the other players via email or another transfer service.<br/><br/>'ScenEdit_SpecialMessage('playerside',as)end;function PBEM_SetPassword(aB,aL)StoreString(\"__SIDE_\"..tostring(aB)..\"_PASSWD\",D.Calc(aL))end;function PBEM_CheckPassword(aB,aL)local aM=GetString(\"__SIDE_\"..tostring(aB)..\"_PASSWD\")return aM==D.Calc(aL)end;function PBEM_EventExists(aN)local aO=ScenEdit_GetEvents()for g=1,#aO do local aP=aO[g]if aP.name==aN then return true end end;return false end;function Turn_GetTurnNumber()return GetNumber('__TURN_CURNUM')end;function Turn_NextTurnNumber()StoreNumber('__TURN_CURNUM',Turn_GetTurnNumber()+1)end;function Turn_GetCurSide()return GetNumber('__TURN_CURSIDE')end;function Turn_GetCurSideName()return PBEM_PLAYABLE_SIDES[Turn_GetCurSide()]end;function Turn_SetCurSide(aB)StoreNumber('__TURN_CURSIDE',aB)end;function Turn_NextSide()local aQ=Turn_GetCurSide()-1;aQ=(1+aQ)%#PBEM_PLAYABLE_SIDES+1;if aQ==1 then Turn_NextTurnNumber()end;Turn_SetCurSide(aQ)ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,switchto=true})end;function PBEM_SelfDestruct()local aR=VP_GetSides()for g=1,#aR do StoreString(\"__SIDE_\"..tostring(g)..\"_PASSWD\",\"\")ScenEdit_RemoveSide({side=aR[g].name})end;PBEM_EndRandom()end;function PBEM_ShowTurnIntro()local aS=Turn_GetCurSide()local ar=Turn_GetTurnNumber()local aT=\"\"if ar>1 or aS>1 then local aG=PBEM_GetKillRegister(aS)if aG==''then aG=\"None.\"end;aT='<br/><u>Losses reported:</u><br/><br/>'..aG end;PBEM_SetKillRegister(aS,\"\")ScenEdit_SpecialMessage('playerside',Message_Header(Turn_GetCurSideName()..' Turn '..tostring(ar))..aT)end;function PBEM_RandomSeed(Q)StoreNumber('__PBEM_RANDOMSEEDVAL',Q)end;function PBEM_NextRandomSeed()PBEM_RandomSeed(__PBEM_FN_RANDOM(-2147483648,2147483647))end;function PBEM_Random(aU,aV)local aW=0;if aU then if aV then aW=__PBEM_FN_RANDOM(aU,aV)else aW=__PBEM_FN_RANDOM(aU)end else aW=__PBEM_FN_RANDOM()end;PBEM_NextRandomSeed()return aW end;function PBEM_InitRandom()if not __PBEM_FN_RANDOMSEED then __PBEM_FN_RANDOMSEED=math.randomseed;__PBEM_FN_RANDOM=math.random end;math.randomseed=function(Q)end;math.random=PBEM_Random;__PBEM_FN_RANDOMSEED(GetNumber('__PBEM_RANDOMSEEDVAL'))__PBEM_FN_RANDOM()__PBEM_FN_RANDOM()__PBEM_FN_RANDOM()PBEM_NextRandomSeed()end;function PBEM_EndRandom()math.randomseed=__PBEM_FN_RANDOMSEED;math.random=__PBEM_FN_RANDOM end;function PBEM_StartTurn()PBEM_SETUP_PHASE=PBEM_HasSetupPhase()PBEM_TURN_LENGTH=PBEM_TurnLength()PBEM_PLAYABLE_SIDES=PBEM_PlayableSides()ScenEdit_SetSideOptions({side=PBEM_DUMMY_SIDE,switchto=true})local aA=Turn_GetCurSideName()local ar=Turn_GetTurnNumber()local aX=ScenEdit_CurrentTime()if ScenEdit_GetSideOptions({side=PBEM_DUMMY_SIDE}).awareness=='Omniscient'then local as=Message_Header(\"End of Scenario (Turn \"..ar..')')..PBEM_ScoreSummary()ScenEdit_SpecialMessage('playerside',as)return end;if ar==1 and not PBEM_SETUP_PHASE and aX==PBEM_GetCurTurnStartTime()or ar==0 and PBEM_SETUP_PHASE then if Turn_GetCurSide()==1 then PBEM_RandomSeed(os.time())if PBEM_OnInitialSetup then PBEM_OnInitialSetup()end end;PBEM_InitRandom()local aY=false;local aZ=0;local a_=\"\"while not aY do aZ=aZ+1;local as=\"\"if aZ>1 then as=\"Passwords didn\\'t match! Please enter your password again:\"else as=aA..\", please choose a password:\"end;a_=Input_String(as)local b0=Input_String(\"Enter password again to confirm:\")if a_==b0 then aY=true end end;PBEM_SetPassword(Turn_GetCurSide(),a_)ScenEdit_SetSideOptions({side=aA,switchto=true})if ar==0 and PBEM_SETUP_PHASE then PBEM_StartSetupPhase()else PBEM_ShowTurnIntro()end else PBEM_InitRandom()local b1=false;while not b1 do local a_=Input_String(aA..\", enter your password to start turn \"..ar..\":\")if PBEM_CheckPassword(Turn_GetCurSide(),a_)then ScenEdit_SetSideOptions({side=aA,switchto=true})b1=true else local b2=ScenEdit_MsgBox(\"The password was incorrect.\",5)if b2~='Retry'then PBEM_SelfDestruct()return end end end;local b3=PBEM_GetCurTurnStartTime()local b4=ScenEdit_CurrentTime()if PBEM_SETUP_PHASE and ar==1 and b4==b3+#PBEM_PLAYABLE_SIDES or b4==b3 then PBEM_ShowTurnIntro()end end end;function PBEM_StartSetupPhase()local aA=ScenEdit_PlayerSide()Input_OK(\"This is the \"..aA..\" setup phase.\\n\\nLeave the game paused until you've finished setting up your loadouts and missions.\\n\\nWhen you're done, click Play to end your turn.\")end;function PBEM_EndSetupPhase()local aA=ScenEdit_PlayerSide()Turn_NextSide()ScenEdit_PlaySound(\"radioChirp5.mp3\")local as=Message_Header('End of '..aA..' Setup Phase')..'Go to <b>File -> Save As...</b>, save this game, and send the save file to the <b>'..Turn_GetCurSideName()..'</b> player via email or another transfer service.<br/><br/><u>IMPORTANT:</u> Do <b>NOT</b> close this window or resume the game before saving, or you will have to replay your turn.'ScenEdit_SpecialMessage('playerside',as)PBEM_EndRandom()end;PBEM_StartTurn()"PBEM_Init()
